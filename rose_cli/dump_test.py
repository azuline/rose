import json

import pytest

from rose import Config, MetadataMatcher
from rose_cli.dump import (
    dump_all_collages,
    dump_all_playlists,
    dump_all_releases,
    dump_all_tracks,
    dump_collage,
    dump_playlist,
    dump_release,
    dump_track,
)


@pytest.mark.usefixtures("seeded_cache")
def test_dump_release(config: Config) -> None:
    assert json.loads(dump_release(config, "r1")) == {
        "id": "r1",
        "source_path": f"{config.music_source_dir}/r1",
        "cover_image_path": None,
        "added_at": "0000-01-01T00:00:00+00:00",
        "releasetitle": "Release 1",
        "releasetype": "album",
        "releasedate": "2023",
        "compositiondate": None,
        "catalognumber": None,
        "new": False,
        "disctotal": 1,
        "genres": ["Techno", "Deep House"],
        "parent_genres": [
            "Dance",
            "Electronic",
            "Electronic Dance Music",
            "House",
        ],
        "labels": ["Silk Music"],
        "originaldate": None,
        "edition": None,
        "secondary_genres": ["Rominimal", "Ambient"],
        "parent_secondary_genres": [
            "Dance",
            "Electronic",
            "Electronic Dance Music",
            "House",
            "Tech House",
        ],
        "descriptors": ["Warm", "Hot"],
        "releaseartists": {
            "main": [
                {"name": "Techno Man", "alias": False},
                {"name": "Bass Man", "alias": False},
            ],
            "guest": [],
            "remixer": [],
            "producer": [],
            "composer": [],
            "conductor": [],
            "djmixer": [],
        },
        "tracks": [
            {
                "trackartists": {
                    "composer": [],
                    "djmixer": [],
                    "guest": [],
                    "main": [
                        {"alias": False, "name": "Techno Man"},
                        {"alias": False, "name": "Bass Man"},
                    ],
                    "producer": [],
                    "remixer": [],
                    "conductor": [],
                },
                "discnumber": "01",
                "duration_seconds": 120,
                "id": "t1",
                "source_path": f"{config.music_source_dir}/r1/01.m4a",
                "tracktitle": "Track 1",
                "tracknumber": "01",
                "tracktotal": 2,
            },
            {
                "trackartists": {
                    "composer": [],
                    "djmixer": [],
                    "guest": [],
                    "main": [
                        {"alias": False, "name": "Techno Man"},
                        {"alias": False, "name": "Bass Man"},
                    ],
                    "producer": [],
                    "remixer": [],
                    "conductor": [],
                },
                "discnumber": "01",
                "duration_seconds": 240,
                "id": "t2",
                "source_path": f"{config.music_source_dir}/r1/02.m4a",
                "tracktitle": "Track 2",
                "tracknumber": "02",
                "tracktotal": 2,
            },
        ],
    }


@pytest.mark.usefixtures("seeded_cache")
def test_dump_releases(config: Config) -> None:
    assert json.loads(dump_all_releases(config)) == [
        {
            "id": "r1",
            "source_path": f"{config.music_source_dir}/r1",
            "cover_image_path": None,
            "added_at": "0000-01-01T00:00:00+00:00",
            "releasetitle": "Release 1",
            "releasetype": "album",
            "releasedate": "2023",
            "compositiondate": None,
            "catalognumber": None,
            "new": False,
            "disctotal": 1,
            "genres": ["Techno", "Deep House"],
            "parent_genres": [
                "Dance",
                "Electronic",
                "Electronic Dance Music",
                "House",
            ],
            "labels": ["Silk Music"],
            "originaldate": None,
            "edition": None,
            "secondary_genres": ["Rominimal", "Ambient"],
            "parent_secondary_genres": [
                "Dance",
                "Electronic",
                "Electronic Dance Music",
                "House",
                "Tech House",
            ],
            "descriptors": ["Warm", "Hot"],
            "releaseartists": {
                "main": [
                    {"name": "Techno Man", "alias": False},
                    {"name": "Bass Man", "alias": False},
                ],
                "guest": [],
                "remixer": [],
                "producer": [],
                "composer": [],
                "conductor": [],
                "djmixer": [],
            },
            "tracks": [
                {
                    "trackartists": {
                        "composer": [],
                        "djmixer": [],
                        "guest": [],
                        "main": [
                            {"alias": False, "name": "Techno Man"},
                            {"alias": False, "name": "Bass Man"},
                        ],
                        "producer": [],
                        "remixer": [],
                        "conductor": [],
                    },
                    "discnumber": "01",
                    "duration_seconds": 120,
                    "id": "t1",
                    "source_path": f"{config.music_source_dir}/r1/01.m4a",
                    "tracktitle": "Track 1",
                    "tracknumber": "01",
                    "tracktotal": 2,
                },
                {
                    "trackartists": {
                        "composer": [],
                        "djmixer": [],
                        "guest": [],
                        "main": [
                            {"alias": False, "name": "Techno Man"},
                            {"alias": False, "name": "Bass Man"},
                        ],
                        "producer": [],
                        "remixer": [],
                        "conductor": [],
                    },
                    "discnumber": "01",
                    "duration_seconds": 240,
                    "id": "t2",
                    "source_path": f"{config.music_source_dir}/r1/02.m4a",
                    "tracktitle": "Track 2",
                    "tracknumber": "02",
                    "tracktotal": 2,
                },
            ],
        },
        {
            "id": "r2",
            "source_path": f"{config.music_source_dir}/r2",
            "cover_image_path": f"{config.music_source_dir}/r2/cover.jpg",
            "added_at": "0000-01-01T00:00:00+00:00",
            "releasetitle": "Release 2",
            "releasetype": "album",
            "releasedate": "2021",
            "compositiondate": None,
            "catalognumber": "DG-001",
            "new": True,
            "disctotal": 1,
            "genres": ["Modern Classical"],
            "parent_genres": ["Classical Music", "Western Classical Music"],
            "labels": ["Native State"],
            "originaldate": "2019",
            "edition": "Deluxe",
            "secondary_genres": ["Orchestral"],
            "parent_secondary_genres": [
                "Classical Music",
                "Western Classical Music",
            ],
            "descriptors": ["Wet"],
            "releaseartists": {
                "main": [{"name": "Violin Woman", "alias": False}],
                "guest": [{"name": "Conductor Woman", "alias": False}],
                "remixer": [],
                "producer": [],
                "composer": [],
                "conductor": [],
                "djmixer": [],
            },
            "tracks": [
                {
                    "trackartists": {
                        "composer": [],
                        "djmixer": [],
                        "guest": [{"alias": False, "name": "Conductor Woman"}],
                        "main": [{"alias": False, "name": "Violin Woman"}],
                        "producer": [],
                        "remixer": [],
                        "conductor": [],
                    },
                    "discnumber": "01",
                    "duration_seconds": 120,
                    "id": "t3",
                    "source_path": f"{config.music_source_dir}/r2/01.m4a",
                    "tracktitle": "Track 1",
                    "tracknumber": "01",
                    "tracktotal": 1,
                }
            ],
        },
        {
            "id": "r3",
            "source_path": f"{config.music_source_dir}/r3",
            "cover_image_path": None,
            "added_at": "0000-01-01T00:00:00+00:00",
            "releasetitle": "Release 3",
            "releasetype": "album",
            "releasedate": "2021-04-20",
            "compositiondate": "1780",
            "catalognumber": "DG-002",
            "new": False,
            "disctotal": 1,
            "genres": [],
            "parent_genres": [],
            "labels": [],
            "originaldate": None,
            "edition": None,
            "secondary_genres": [],
            "parent_secondary_genres": [],
            "descriptors": [],
            "releaseartists": {
                "main": [],
                "guest": [],
                "remixer": [],
                "producer": [],
                "composer": [],
                "conductor": [],
                "djmixer": [],
            },
            "tracks": [
                {
                    "trackartists": {
                        "composer": [],
                        "djmixer": [],
                        "guest": [],
                        "main": [],
                        "producer": [],
                        "remixer": [],
                        "conductor": [],
                    },
                    "discnumber": "01",
                    "duration_seconds": 120,
                    "id": "t4",
                    "source_path": f"{config.music_source_dir}/r3/01.m4a",
                    "tracktitle": "Track 1",
                    "tracknumber": "01",
                    "tracktotal": 1,
                }
            ],
        },
    ]


@pytest.mark.usefixtures("seeded_cache")
def test_dump_releases_matcher(config: Config) -> None:
    matcher = MetadataMatcher.parse("releasetitle:2$")
    assert json.loads(dump_all_releases(config, matcher)) == [
        {
            "id": "r2",
            "source_path": f"{config.music_source_dir}/r2",
            "cover_image_path": f"{config.music_source_dir}/r2/cover.jpg",
            "added_at": "0000-01-01T00:00:00+00:00",
            "releasetitle": "Release 2",
            "releasetype": "album",
            "releasedate": "2021",
            "compositiondate": None,
            "catalognumber": "DG-001",
            "new": True,
            "disctotal": 1,
            "genres": ["Modern Classical"],
            "parent_genres": ["Classical Music", "Western Classical Music"],
            "labels": ["Native State"],
            "originaldate": "2019",
            "edition": "Deluxe",
            "secondary_genres": ["Orchestral"],
            "parent_secondary_genres": [
                "Classical Music",
                "Western Classical Music",
            ],
            "descriptors": ["Wet"],
            "releaseartists": {
                "main": [{"name": "Violin Woman", "alias": False}],
                "guest": [{"name": "Conductor Woman", "alias": False}],
                "remixer": [],
                "producer": [],
                "composer": [],
                "conductor": [],
                "djmixer": [],
            },
            "tracks": [
                {
                    "trackartists": {
                        "composer": [],
                        "djmixer": [],
                        "guest": [{"name": "Conductor Woman", "alias": False}],
                        "main": [{"name": "Violin Woman", "alias": False}],
                        "producer": [],
                        "remixer": [],
                        "conductor": [],
                    },
                    "discnumber": "01",
                    "duration_seconds": 120,
                    "id": "t3",
                    "source_path": f"{config.music_source_dir}/r2/01.m4a",
                    "tracktitle": "Track 1",
                    "tracknumber": "01",
                    "tracktotal": 1,
                }
            ],
        },
    ]


@pytest.mark.usefixtures("seeded_cache")
def test_dump_tracks(config: Config) -> None:
    assert json.loads(dump_all_tracks(config)) == [
        {
            "trackartists": {
                "composer": [],
                "djmixer": [],
                "guest": [],
                "main": [
                    {"alias": False, "name": "Techno Man"},
                    {"alias": False, "name": "Bass Man"},
                ],
                "producer": [],
                "remixer": [],
                "conductor": [],
            },
            "discnumber": "01",
            "disctotal": 1,
            "duration_seconds": 120,
            "id": "t1",
            "source_path": f"{config.music_source_dir}/r1/01.m4a",
            "tracktitle": "Track 1",
            "tracknumber": "01",
            "tracktotal": 2,
            "added_at": "0000-01-01T00:00:00+00:00",
            "release_id": "r1",
            "releasetitle": "Release 1",
            "releasetype": "album",
            "releasedate": "2023",
            "compositiondate": None,
            "catalognumber": None,
            "new": False,
            "genres": ["Techno", "Deep House"],
            "parent_genres": [
                "Dance",
                "Electronic",
                "Electronic Dance Music",
                "House",
            ],
            "labels": ["Silk Music"],
            "originaldate": None,
            "edition": None,
            "secondary_genres": ["Rominimal", "Ambient"],
            "parent_secondary_genres": [
                "Dance",
                "Electronic",
                "Electronic Dance Music",
                "House",
                "Tech House",
            ],
            "descriptors": ["Warm", "Hot"],
            "releaseartists": {
                "main": [
                    {"name": "Techno Man", "alias": False},
                    {"name": "Bass Man", "alias": False},
                ],
                "guest": [],
                "remixer": [],
                "conductor": [],
                "producer": [],
                "composer": [],
                "djmixer": [],
            },
        },
        {
            "trackartists": {
                "composer": [],
                "djmixer": [],
                "guest": [],
                "main": [
                    {"alias": False, "name": "Techno Man"},
                    {"alias": False, "name": "Bass Man"},
                ],
                "producer": [],
                "remixer": [],
                "conductor": [],
            },
            "discnumber": "01",
            "disctotal": 1,
            "duration_seconds": 240,
            "id": "t2",
            "source_path": f"{config.music_source_dir}/r1/02.m4a",
            "tracktitle": "Track 2",
            "tracknumber": "02",
            "tracktotal": 2,
            "added_at": "0000-01-01T00:00:00+00:00",
            "release_id": "r1",
            "releasetitle": "Release 1",
            "releasetype": "album",
            "releasedate": "2023",
            "compositiondate": None,
            "catalognumber": None,
            "new": False,
            "genres": ["Techno", "Deep House"],
            "parent_genres": [
                "Dance",
                "Electronic",
                "Electronic Dance Music",
                "House",
            ],
            "labels": ["Silk Music"],
            "originaldate": None,
            "edition": None,
            "secondary_genres": ["Rominimal", "Ambient"],
            "parent_secondary_genres": [
                "Dance",
                "Electronic",
                "Electronic Dance Music",
                "House",
                "Tech House",
            ],
            "descriptors": ["Warm", "Hot"],
            "releaseartists": {
                "main": [
                    {"name": "Techno Man", "alias": False},
                    {"name": "Bass Man", "alias": False},
                ],
                "guest": [],
                "remixer": [],
                "conductor": [],
                "producer": [],
                "composer": [],
                "djmixer": [],
            },
        },
        {
            "trackartists": {
                "composer": [],
                "djmixer": [],
                "guest": [{"alias": False, "name": "Conductor Woman"}],
                "main": [{"alias": False, "name": "Violin Woman"}],
                "producer": [],
                "remixer": [],
                "conductor": [],
            },
            "discnumber": "01",
            "disctotal": 1,
            "duration_seconds": 120,
            "id": "t3",
            "source_path": f"{config.music_source_dir}/r2/01.m4a",
            "tracktitle": "Track 1",
            "tracknumber": "01",
            "tracktotal": 1,
            "added_at": "0000-01-01T00:00:00+00:00",
            "release_id": "r2",
            "releasetitle": "Release 2",
            "releasetype": "album",
            "releasedate": "2021",
            "compositiondate": None,
            "catalognumber": "DG-001",
            "new": True,
            "genres": ["Modern Classical"],
            "parent_genres": ["Classical Music", "Western Classical Music"],
            "labels": ["Native State"],
            "originaldate": "2019",
            "edition": "Deluxe",
            "secondary_genres": ["Orchestral"],
            "parent_secondary_genres": [
                "Classical Music",
                "Western Classical Music",
            ],
            "descriptors": ["Wet"],
            "releaseartists": {
                "main": [{"name": "Violin Woman", "alias": False}],
                "guest": [{"name": "Conductor Woman", "alias": False}],
                "remixer": [],
                "conductor": [],
                "producer": [],
                "composer": [],
                "djmixer": [],
            },
        },
        {
            "trackartists": {
                "composer": [],
                "djmixer": [],
                "guest": [],
                "main": [],
                "producer": [],
                "remixer": [],
                "conductor": [],
            },
            "discnumber": "01",
            "disctotal": 1,
            "duration_seconds": 120,
            "id": "t4",
            "source_path": f"{config.music_source_dir}/r3/01.m4a",
            "tracktitle": "Track 1",
            "tracknumber": "01",
            "tracktotal": 1,
            "added_at": "0000-01-01T00:00:00+00:00",
            "release_id": "r3",
            "releasetitle": "Release 3",
            "releasetype": "album",
            "releasedate": "2021-04-20",
            "compositiondate": "1780",
            "catalognumber": "DG-002",
            "new": False,
            "genres": [],
            "parent_genres": [],
            "labels": [],
            "originaldate": None,
            "edition": None,
            "secondary_genres": [],
            "parent_secondary_genres": [],
            "descriptors": [],
            "releaseartists": {
                "main": [],
                "guest": [],
                "remixer": [],
                "conductor": [],
                "producer": [],
                "composer": [],
                "djmixer": [],
            },
        },
    ]


@pytest.mark.usefixtures("seeded_cache")
def test_dump_tracks_with_matcher(config: Config) -> None:
    matcher = MetadataMatcher.parse("artist:Techno Man")
    assert json.loads(dump_all_tracks(config, matcher)) == [
        {
            "trackartists": {
                "composer": [],
                "djmixer": [],
                "guest": [],
                "main": [
                    {"alias": False, "name": "Techno Man"},
                    {"alias": False, "name": "Bass Man"},
                ],
                "producer": [],
                "remixer": [],
                "conductor": [],
            },
            "discnumber": "01",
            "disctotal": 1,
            "duration_seconds": 120,
            "id": "t1",
            "source_path": f"{config.music_source_dir}/r1/01.m4a",
            "tracktitle": "Track 1",
            "tracknumber": "01",
            "tracktotal": 2,
            "added_at": "0000-01-01T00:00:00+00:00",
            "release_id": "r1",
            "releasetitle": "Release 1",
            "releasetype": "album",
            "releasedate": "2023",
            "compositiondate": None,
            "catalognumber": None,
            "new": False,
            "genres": ["Techno", "Deep House"],
            "parent_genres": [
                "Dance",
                "Electronic",
                "Electronic Dance Music",
                "House",
            ],
            "labels": ["Silk Music"],
            "originaldate": None,
            "edition": None,
            "secondary_genres": ["Rominimal", "Ambient"],
            "parent_secondary_genres": [
                "Dance",
                "Electronic",
                "Electronic Dance Music",
                "House",
                "Tech House",
            ],
            "descriptors": ["Warm", "Hot"],
            "releaseartists": {
                "main": [
                    {"name": "Techno Man", "alias": False},
                    {"name": "Bass Man", "alias": False},
                ],
                "guest": [],
                "remixer": [],
                "conductor": [],
                "producer": [],
                "composer": [],
                "djmixer": [],
            },
        },
        {
            "trackartists": {
                "composer": [],
                "djmixer": [],
                "guest": [],
                "main": [
                    {"alias": False, "name": "Techno Man"},
                    {"alias": False, "name": "Bass Man"},
                ],
                "producer": [],
                "remixer": [],
                "conductor": [],
            },
            "discnumber": "01",
            "disctotal": 1,
            "duration_seconds": 240,
            "id": "t2",
            "source_path": f"{config.music_source_dir}/r1/02.m4a",
            "tracktitle": "Track 2",
            "tracknumber": "02",
            "tracktotal": 2,
            "added_at": "0000-01-01T00:00:00+00:00",
            "release_id": "r1",
            "releasetitle": "Release 1",
            "releasetype": "album",
            "releasedate": "2023",
            "compositiondate": None,
            "catalognumber": None,
            "new": False,
            "genres": ["Techno", "Deep House"],
            "parent_genres": [
                "Dance",
                "Electronic",
                "Electronic Dance Music",
                "House",
            ],
            "labels": ["Silk Music"],
            "originaldate": None,
            "edition": None,
            "secondary_genres": ["Rominimal", "Ambient"],
            "parent_secondary_genres": [
                "Dance",
                "Electronic",
                "Electronic Dance Music",
                "House",
                "Tech House",
            ],
            "descriptors": ["Warm", "Hot"],
            "releaseartists": {
                "main": [
                    {"name": "Techno Man", "alias": False},
                    {"name": "Bass Man", "alias": False},
                ],
                "guest": [],
                "remixer": [],
                "conductor": [],
                "producer": [],
                "composer": [],
                "djmixer": [],
            },
        },
    ]


@pytest.mark.usefixtures("seeded_cache")
def test_dump_track(config: Config) -> None:
    assert json.loads(dump_track(config, "t1")) == {
        "trackartists": {
            "composer": [],
            "djmixer": [],
            "guest": [],
            "main": [
                {"alias": False, "name": "Techno Man"},
                {"alias": False, "name": "Bass Man"},
            ],
            "producer": [],
            "remixer": [],
            "conductor": [],
        },
        "discnumber": "01",
        "disctotal": 1,
        "duration_seconds": 120,
        "id": "t1",
        "source_path": f"{config.music_source_dir}/r1/01.m4a",
        "tracktitle": "Track 1",
        "tracknumber": "01",
        "tracktotal": 2,
        "added_at": "0000-01-01T00:00:00+00:00",
        "release_id": "r1",
        "releasetitle": "Release 1",
        "releasetype": "album",
        "releasedate": "2023",
        "compositiondate": None,
        "catalognumber": None,
        "new": False,
        "genres": ["Techno", "Deep House"],
        "parent_genres": [
            "Dance",
            "Electronic",
            "Electronic Dance Music",
            "House",
        ],
        "labels": ["Silk Music"],
        "originaldate": None,
        "edition": None,
        "secondary_genres": ["Rominimal", "Ambient"],
        "parent_secondary_genres": [
            "Dance",
            "Electronic",
            "Electronic Dance Music",
            "House",
            "Tech House",
        ],
        "descriptors": ["Warm", "Hot"],
        "releaseartists": {
            "main": [
                {"name": "Techno Man", "alias": False},
                {"name": "Bass Man", "alias": False},
            ],
            "guest": [],
            "remixer": [],
            "producer": [],
            "composer": [],
            "conductor": [],
            "djmixer": [],
        },
    }


@pytest.mark.usefixtures("seeded_cache")
def test_dump_collage(config: Config) -> None:
    out = dump_collage(config, "Rose Gold")
    assert json.loads(out) == {
        "name": "Rose Gold",
        "releases": [
            {
                "position": 1,
                "id": "r1",
                "source_path": f"{config.music_source_dir}/r1",
                "cover_image_path": None,
                "added_at": "0000-01-01T00:00:00+00:00",
                "releasetitle": "Release 1",
                "releasetype": "album",
                "releasedate": "2023",
                "compositiondate": None,
                "catalognumber": None,
                "new": False,
                "disctotal": 1,
                "genres": ["Techno", "Deep House"],
                "parent_genres": [
                    "Dance",
                    "Electronic",
                    "Electronic Dance Music",
                    "House",
                ],
                "labels": ["Silk Music"],
                "originaldate": None,
                "edition": None,
                "secondary_genres": ["Rominimal", "Ambient"],
                "parent_secondary_genres": [
                    "Dance",
                    "Electronic",
                    "Electronic Dance Music",
                    "House",
                    "Tech House",
                ],
                "descriptors": ["Warm", "Hot"],
                "releaseartists": {
                    "main": [
                        {"name": "Techno Man", "alias": False},
                        {"name": "Bass Man", "alias": False},
                    ],
                    "guest": [],
                    "remixer": [],
                    "conductor": [],
                    "producer": [],
                    "composer": [],
                    "djmixer": [],
                },
            },
            {
                "position": 2,
                "id": "r2",
                "source_path": f"{config.music_source_dir}/r2",
                "cover_image_path": f"{config.music_source_dir}/r2/cover.jpg",
                "added_at": "0000-01-01T00:00:00+00:00",
                "releasetitle": "Release 2",
                "releasetype": "album",
                "releasedate": "2021",
                "compositiondate": None,
                "catalognumber": "DG-001",
                "new": True,
                "disctotal": 1,
                "genres": ["Modern Classical"],
                "parent_genres": ["Classical Music", "Western Classical Music"],
                "labels": ["Native State"],
                "originaldate": "2019",
                "edition": "Deluxe",
                "secondary_genres": ["Orchestral"],
                "parent_secondary_genres": [
                    "Classical Music",
                    "Western Classical Music",
                ],
                "descriptors": ["Wet"],
                "releaseartists": {
                    "main": [{"name": "Violin Woman", "alias": False}],
                    "guest": [{"name": "Conductor Woman", "alias": False}],
                    "remixer": [],
                    "conductor": [],
                    "producer": [],
                    "composer": [],
                    "djmixer": [],
                },
            },
        ],
    }


@pytest.mark.usefixtures("seeded_cache")
def test_dump_collages(config: Config) -> None:
    out = dump_all_collages(config)
    assert json.loads(out) == [
        {
            "name": "Rose Gold",
            "releases": [
                {
                    "position": 1,
                    "id": "r1",
                    "source_path": f"{config.music_source_dir}/r1",
                    "cover_image_path": None,
                    "added_at": "0000-01-01T00:00:00+00:00",
                    "releasetitle": "Release 1",
                    "releasetype": "album",
                    "releasedate": "2023",
                    "compositiondate": None,
                    "catalognumber": None,
                    "new": False,
                    "disctotal": 1,
                    "genres": ["Techno", "Deep House"],
                    "parent_genres": [
                        "Dance",
                        "Electronic",
                        "Electronic Dance Music",
                        "House",
                    ],
                    "labels": ["Silk Music"],
                    "originaldate": None,
                    "edition": None,
                    "secondary_genres": ["Rominimal", "Ambient"],
                    "parent_secondary_genres": [
                        "Dance",
                        "Electronic",
                        "Electronic Dance Music",
                        "House",
                        "Tech House",
                    ],
                    "descriptors": ["Warm", "Hot"],
                    "releaseartists": {
                        "main": [
                            {"name": "Techno Man", "alias": False},
                            {"name": "Bass Man", "alias": False},
                        ],
                        "guest": [],
                        "remixer": [],
                        "conductor": [],
                        "producer": [],
                        "composer": [],
                        "djmixer": [],
                    },
                },
                {
                    "position": 2,
                    "id": "r2",
                    "source_path": f"{config.music_source_dir}/r2",
                    "cover_image_path": f"{config.music_source_dir}/r2/cover.jpg",
                    "added_at": "0000-01-01T00:00:00+00:00",
                    "releasetitle": "Release 2",
                    "releasetype": "album",
                    "releasedate": "2021",
                    "compositiondate": None,
                    "catalognumber": "DG-001",
                    "new": True,
                    "disctotal": 1,
                    "genres": ["Modern Classical"],
                    "parent_genres": ["Classical Music", "Western Classical Music"],
                    "labels": ["Native State"],
                    "originaldate": "2019",
                    "edition": "Deluxe",
                    "secondary_genres": ["Orchestral"],
                    "parent_secondary_genres": [
                        "Classical Music",
                        "Western Classical Music",
                    ],
                    "descriptors": ["Wet"],
                    "releaseartists": {
                        "main": [{"name": "Violin Woman", "alias": False}],
                        "guest": [{"name": "Conductor Woman", "alias": False}],
                        "remixer": [],
                        "conductor": [],
                        "producer": [],
                        "composer": [],
                        "djmixer": [],
                    },
                },
            ],
        },
        {"name": "Ruby Red", "releases": []},
    ]


@pytest.mark.usefixtures("seeded_cache")
def test_dump_playlist(config: Config) -> None:
    out = dump_playlist(config, "Lala Lisa")
    assert json.loads(out) == {
        "name": "Lala Lisa",
        "cover_image_path": f"{config.music_source_dir}/!playlists/Lala Lisa.jpg",
        "tracks": [
            {
                "position": 1,
                "id": "t1",
                "source_path": f"{config.music_source_dir}/r1/01.m4a",
                "tracktitle": "Track 1",
                "tracknumber": "01",
                "tracktotal": 2,
                "discnumber": "01",
                "disctotal": 1,
                "duration_seconds": 120,
                "trackartists": {
                    "main": [
                        {"name": "Techno Man", "alias": False},
                        {"name": "Bass Man", "alias": False},
                    ],
                    "guest": [],
                    "remixer": [],
                    "producer": [],
                    "composer": [],
                    "conductor": [],
                    "djmixer": [],
                },
                "added_at": "0000-01-01T00:00:00+00:00",
                "release_id": "r1",
                "releasetitle": "Release 1",
                "releasetype": "album",
                "releasedate": "2023",
                "compositiondate": None,
                "catalognumber": None,
                "new": False,
                "genres": ["Techno", "Deep House"],
                "parent_genres": [
                    "Dance",
                    "Electronic",
                    "Electronic Dance Music",
                    "House",
                ],
                "labels": ["Silk Music"],
                "originaldate": None,
                "edition": None,
                "secondary_genres": ["Rominimal", "Ambient"],
                "parent_secondary_genres": [
                    "Dance",
                    "Electronic",
                    "Electronic Dance Music",
                    "House",
                    "Tech House",
                ],
                "descriptors": ["Warm", "Hot"],
                "releaseartists": {
                    "main": [
                        {"name": "Techno Man", "alias": False},
                        {"name": "Bass Man", "alias": False},
                    ],
                    "guest": [],
                    "remixer": [],
                    "producer": [],
                    "composer": [],
                    "conductor": [],
                    "djmixer": [],
                },
            },
            {
                "position": 2,
                "id": "t3",
                "source_path": f"{config.music_source_dir}/r2/01.m4a",
                "tracktitle": "Track 1",
                "tracknumber": "01",
                "tracktotal": 1,
                "discnumber": "01",
                "disctotal": 1,
                "duration_seconds": 120,
                "trackartists": {
                    "main": [{"name": "Violin Woman", "alias": False}],
                    "guest": [{"name": "Conductor Woman", "alias": False}],
                    "remixer": [],
                    "producer": [],
                    "composer": [],
                    "conductor": [],
                    "djmixer": [],
                },
                "added_at": "0000-01-01T00:00:00+00:00",
                "release_id": "r2",
                "releasetitle": "Release 2",
                "releasetype": "album",
                "releasedate": "2021",
                "compositiondate": None,
                "catalognumber": "DG-001",
                "new": True,
                "genres": ["Modern Classical"],
                "parent_genres": ["Classical Music", "Western Classical Music"],
                "labels": ["Native State"],
                "originaldate": "2019",
                "edition": "Deluxe",
                "secondary_genres": ["Orchestral"],
                "parent_secondary_genres": [
                    "Classical Music",
                    "Western Classical Music",
                ],
                "descriptors": ["Wet"],
                "releaseartists": {
                    "main": [{"name": "Violin Woman", "alias": False}],
                    "guest": [{"name": "Conductor Woman", "alias": False}],
                    "remixer": [],
                    "producer": [],
                    "composer": [],
                    "conductor": [],
                    "djmixer": [],
                },
            },
        ],
    }


@pytest.mark.usefixtures("seeded_cache")
def test_dump_playlists(config: Config) -> None:
    out = dump_all_playlists(config)
    assert json.loads(out) == [
        {
            "name": "Lala Lisa",
            "cover_image_path": f"{config.music_source_dir}/!playlists/Lala Lisa.jpg",
            "tracks": [
                {
                    "position": 1,
                    "id": "t1",
                    "source_path": f"{config.music_source_dir}/r1/01.m4a",
                    "tracktitle": "Track 1",
                    "tracknumber": "01",
                    "tracktotal": 2,
                    "discnumber": "01",
                    "disctotal": 1,
                    "duration_seconds": 120,
                    "trackartists": {
                        "main": [
                            {"name": "Techno Man", "alias": False},
                            {"name": "Bass Man", "alias": False},
                        ],
                        "guest": [],
                        "remixer": [],
                        "producer": [],
                        "composer": [],
                        "conductor": [],
                        "djmixer": [],
                    },
                    "added_at": "0000-01-01T00:00:00+00:00",
                    "release_id": "r1",
                    "releasetitle": "Release 1",
                    "releasetype": "album",
                    "releasedate": "2023",
                    "compositiondate": None,
                    "catalognumber": None,
                    "new": False,
                    "genres": ["Techno", "Deep House"],
                    "parent_genres": [
                        "Dance",
                        "Electronic",
                        "Electronic Dance Music",
                        "House",
                    ],
                    "labels": ["Silk Music"],
                    "originaldate": None,
                    "edition": None,
                    "secondary_genres": ["Rominimal", "Ambient"],
                    "parent_secondary_genres": [
                        "Dance",
                        "Electronic",
                        "Electronic Dance Music",
                        "House",
                        "Tech House",
                    ],
                    "descriptors": ["Warm", "Hot"],
                    "releaseartists": {
                        "main": [
                            {"name": "Techno Man", "alias": False},
                            {"name": "Bass Man", "alias": False},
                        ],
                        "guest": [],
                        "remixer": [],
                        "producer": [],
                        "composer": [],
                        "conductor": [],
                        "djmixer": [],
                    },
                },
                {
                    "position": 2,
                    "id": "t3",
                    "source_path": f"{config.music_source_dir}/r2/01.m4a",
                    "tracktitle": "Track 1",
                    "tracknumber": "01",
                    "tracktotal": 1,
                    "discnumber": "01",
                    "disctotal": 1,
                    "duration_seconds": 120,
                    "trackartists": {
                        "main": [{"name": "Violin Woman", "alias": False}],
                        "guest": [{"name": "Conductor Woman", "alias": False}],
                        "remixer": [],
                        "producer": [],
                        "composer": [],
                        "conductor": [],
                        "djmixer": [],
                    },
                    "added_at": "0000-01-01T00:00:00+00:00",
                    "release_id": "r2",
                    "releasetitle": "Release 2",
                    "releasetype": "album",
                    "releasedate": "2021",
                    "compositiondate": None,
                    "catalognumber": "DG-001",
                    "new": True,
                    "genres": ["Modern Classical"],
                    "parent_genres": ["Classical Music", "Western Classical Music"],
                    "labels": ["Native State"],
                    "originaldate": "2019",
                    "edition": "Deluxe",
                    "secondary_genres": ["Orchestral"],
                    "parent_secondary_genres": [
                        "Classical Music",
                        "Western Classical Music",
                    ],
                    "descriptors": ["Wet"],
                    "releaseartists": {
                        "main": [{"name": "Violin Woman", "alias": False}],
                        "guest": [{"name": "Conductor Woman", "alias": False}],
                        "remixer": [],
                        "producer": [],
                        "composer": [],
                        "conductor": [],
                        "djmixer": [],
                    },
                },
            ],
        },
        {"name": "Turtle Rabbit", "cover_image_path": None, "tracks": []},
    ]
